import"../chunks/CWj6FrbW.js";import{i as Ye}from"../chunks/Bykrahq8.js";import{p as qe,s as i,g as e,o as Ce,l as Ie,k as Le,f as d,h as Me,a as oe,t as h,e as z,b as l,c as Te,m,$ as Pe,i as f,u as p,j as o,d as v,r,n as W}from"../chunks/C1cF_f_f.js";import{i as b}from"../chunks/oCXtbbpy.js";import{e as Re}from"../chunks/sx0AX0zF.js";import{s as Ue}from"../chunks/KxSqMrGa.js";import{s as B}from"../chunks/Bfc47y5P.js";import{g as re}from"../chunks/C9t7Hmsj.js";import{a as Ee,i as Ve,o as We,d as Be,b as Ge,s as He,r as Je,c as Ke}from"../chunks/D1b5UXiN.js";var Qe=d('<button class="btn" style="width: auto; padding: 0.5rem 1rem;"> </button>'),Xe=d('<div class="card" style="background: #fef3c7; border-left: 4px solid #f59e0b;"><div style="display: flex; justify-content: space-between; align-items: center;"><div><p class="font-bold"> </p> <p class="text-gray-600">Connect to internet to sync your data</p></div> <!></div></div>'),Ze=d('<div class="card" style="background: #d1fae5; border-left: 4px solid #10b981;"><p class="text-green-600"> </p></div>'),et=d('<p class="text-red-600 mt-4"> </p>'),tt=d('<div class="card"><button class="btn"> </button> <!></div>'),at=d('<p class="text-gray-600">Try downloading forms from the server</p>'),st=d('<p class="text-gray-600">Connect to internet to download forms</p>'),ot=d('<div class="card text-center"><p class="text-gray-600">No forms available</p> <!></div>'),rt=d('<p class="text-green-600 text-sm">‚úÖ Downloaded for offline use</p>'),it=d('<p class="text-gray-500 text-sm">‚ö†Ô∏è Not downloaded - requires internet</p>'),nt=d('<button class="btn-secondary" style="width: auto; padding: 0.5rem 1rem; font-size: 0.875rem;">üóëÔ∏è Remove</button> <button class="btn" style="width: auto; padding: 0.5rem 1rem; font-size: 0.875rem;"> </button>',1),lt=d('<button class="btn" style="width: auto; padding: 0.5rem 1rem; font-size: 0.875rem;"> </button>'),dt=d('<div style="display: flex; gap: 0.5rem;"><!></div>'),vt=d('<div class="card"><div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;"><div style="flex: 1; cursor: pointer;"><h3 class="font-bold"> </h3> <p class="text-gray-600"> </p> <!></div> <div style="font-size: 1.5rem; margin-left: 1rem;">‚ñ∂Ô∏è</div></div> <!></div>'),ct=d('<div class="mb-4"><h2 class="text-lg font-bold mb-4"> </h2> <!></div>'),ut=d(`<div class="card" style="background: #fee2e2; border-left: 4px solid #ef4444;"><p class="text-red-600 font-bold">üî¥ You are offline</p> <p class="text-gray-600">You can still fill out forms. Your data will be saved locally and synced when you're back online.</p></div>`),ft=d('<div> </div> <div class="container" style="margin-top: 3rem;"><div class="card"><div style="display: flex; justify-content: space-between; align-items: center;"><div><h1 class="text-xl font-bold"> </h1> <p class="text-gray-600">Available Forms</p></div> <button class="btn-secondary" style="width: auto; padding: 0.5rem 1rem;">Logout</button></div></div> <!> <!> <!> <!> <!></div>',1);function Ft(ie,ne){qe(ne,!1);const q=m();let C=m(null),y=m(!0),$=m([]),R=m([]),O=m([]),I=m(!1),L=m(!1),A=m(""),g=m(""),x=m(null);Ee.subscribe(t=>{i(C,t.user),e(C)||re("/")}),Ve.subscribe(t=>{i(y,t)}),We.subscribe(t=>{i($,t.forms||[]),i(R,t.submissions||[]),i(O,t.downloadedForms||[])}),Ce(()=>{e(y)&&G()});async function G(){i(I,!0),i(A,"");const t=await Be();t.success?i($,t.forms):i(A,t.error||"Failed to download forms"),i(I,!1)}async function H(t){i(x,t);const s=await Ke(t);s.success||(i(A,s.error||"Failed to download form"),setTimeout(()=>{i(A,"")},3e3)),i(x,null)}function le(t){Je(t)}async function de(){if(!e(y)){i(g,"You need to be online to sync");return}i(L,!0),i(g,"");const t=await He();t.success?t.synced>0?(i(g,`‚úÖ Successfully synced ${t.synced} submission${t.synced>1?"s":""}`),t.failed>0&&i(g,e(g)+` (${t.failed} failed)`)):i(g,"‚úÖ All submissions are already synced"):i(g,`‚ùå Sync failed: ${t.failed||0} submissions could not be synced`),i(L,!1),setTimeout(()=>{i(g,"")},5e3)}function ve(){Ge()}function ce(t){re(`/forms/${t}`)}Ie(()=>e(R),()=>{i(q,e(R).filter(t=>!t.synced).length)}),Le(),Ye();var J=ft();Me(t=>{Pe.title="Forms - Aid Platform Mobile"});var M=oe(J);let K;var ue=o(M,!0);r(M);var Q=v(M,2),U=o(Q),X=o(U),E=o(X),Z=o(E),fe=o(Z);r(Z),W(2),r(E);var _e=v(E,2);r(X),r(U);var ee=v(U,2);{var me=t=>{var s=Xe(),n=o(s),_=o(n),S=o(_),c=o(S);r(S),W(2),r(_);var a=v(_,2);{var w=F=>{var k=Qe(),Y=o(k,!0);r(k),h(()=>{k.disabled=e(L),f(Y,e(L)?"Syncing...":"Sync Now")}),z("click",k,de),l(F,k)};b(a,F=>{e(y)&&F(w)})}r(n),r(s),h(()=>f(c,`üì§ ${e(q)??""} submission${e(q)>1?"s":""} pending sync`)),l(t,s)};b(ee,t=>{e(q)>0&&t(me)})}var te=v(ee,2);{var pe=t=>{var s=Ze(),n=o(s),_=o(n,!0);r(n),r(s),h(()=>f(_,e(g))),l(t,s)};b(te,t=>{e(g)&&t(pe)})}var ae=v(te,2);{var be=t=>{var s=tt(),n=o(s),_=o(n,!0);r(n);var S=v(n,2);{var c=a=>{var w=et(),F=o(w,!0);r(w),h(()=>f(F,e(A))),l(a,w)};b(S,a=>{e(A)&&a(c)})}r(s),h(()=>{n.disabled=e(I),f(_,e(I)?"Downloading Forms...":"üì• Download Latest Forms")}),z("click",n,G),l(t,s)};b(ae,t=>{e(y)&&t(be)})}var se=v(ae,2);{var ye=t=>{var s=ot(),n=v(o(s),2);{var _=c=>{var a=at();l(c,a)},S=c=>{var a=st();l(c,a)};b(n,c=>{e(y)?c(_):c(S,!1)})}r(s),l(t,s)},ge=t=>{var s=ct(),n=o(s),_=o(n);r(n);var S=v(n,2);Re(S,1,()=>e($),c=>c.id,(c,a)=>{var w=vt(),F=o(w),k=o(F),Y=o(k),we=o(Y,!0);r(Y);var V=v(Y,2),Fe=o(V);r(V);var ke=v(V,2);{var Se=u=>{var j=rt();l(u,j)},De=u=>{var j=it();l(u,j)};b(ke,u=>{e(O),e(a),p(()=>e(O).includes(e(a).id))?u(Se):u(De,!1)})}r(k),W(2),r(F);var $e=v(F,2);{var je=u=>{var j=dt(),ze=o(j);{var Ae=N=>{var D=nt(),T=oe(D),P=v(T,2),Oe=o(P,!0);r(P),h(()=>{P.disabled=(e(x),e(a),p(()=>e(x)===e(a).id)),f(Oe,(e(x),e(a),p(()=>e(x)===e(a).id?"Updating...":"üîÑ Update")))}),z("click",T,B(()=>le(e(a).id))),z("click",P,B(()=>H(e(a).id))),l(N,D)},Ne=N=>{var D=lt(),T=o(D,!0);r(D),h(()=>{D.disabled=(e(x),e(a),p(()=>e(x)===e(a).id)),f(T,(e(x),e(a),p(()=>e(x)===e(a).id?"Downloading...":"üì• Download")))}),z("click",D,B(()=>H(e(a).id))),l(N,D)};b(ze,N=>{e(O),e(a),p(()=>e(O).includes(e(a).id))?N(Ae):N(Ne,!1)})}r(j),l(u,j)};b($e,u=>{e(y)&&u(je)})}r(w),h(()=>{f(we,(e(a),p(()=>e(a).formName))),f(Fe,`${e(a),p(()=>{var u;return((u=e(a).questions)==null?void 0:u.length)||0})??""} questions`)}),z("click",k,()=>ce(e(a).id)),l(c,w)}),r(s),h(()=>f(_,`üìã Available Forms (${e($),p(()=>e($).length)??""})`)),l(t,s)};b(se,t=>{e($),p(()=>e($).length===0)?t(ye):t(ge,!1)})}var xe=v(se,2);{var he=t=>{var s=ut();l(t,s)};b(xe,t=>{e(y)||t(he)})}r(Q),h(t=>{K=Ue(M,1,"status-bar",null,K,t),f(ue,e(y)?"üü¢ Online":"üî¥ Offline"),f(fe,`Welcome, ${e(C),p(()=>{var s;return((s=e(C))==null?void 0:s.email)||"Volunteer"})??""}`)},[()=>({online:e(y)})]),z("click",_e,ve),l(ie,J),Te()}export{Ft as component};
